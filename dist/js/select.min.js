!function(e,t){"function"==typeof define&&define.amd?define(["tether"],t):"object"==typeof exports?module.exports=t(require("tether")):e.Select=t(e.Tether)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(){var e=window.innerWidth,t=window.innerHeight;return E&&(640>=e||640>=t)}function o(e){return Array.prototype.reduce.call(e,function(e,t){return e===t?t:!1})}function r(){var e=document.querySelector(".select-target-focused");return e?e.selectInstance:null}function s(e){var t=r();if(t&&0!==e.charCode){e.keyCode===k&&e.preventDefault(),clearTimeout(T),T=setTimeout(function(){L=""},500),L+=String.fromCharCode(e.charCode);var n=t.findOptionsByPrefix(L);if(1===n.length&&t.selectOption(n[0]),L.length>1&&o(L)){var i=t.findOptionsByPrefix(L[0]);if(i.length){var s=i.indexOf(t.getChosen());return s+=1,s%=i.length,void t.selectOption(i[s])}}return n.length?void t.selectOption(n[0]):void 0}}function c(e){var t=r();if(t)if([b,O,m].indexOf(e.keyCode)>=0&&e.preventDefault(),t.isOpen())switch(e.keyCode){case b:case O:t.moveHighlight(e.keyCode);break;case y:t.selectHighlightedOption();break;case m:t.close(),t.target.focus()}else[b,O,k].indexOf(e.keyCode)>=0&&t.open()}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e,t,n){for(var i=!0;i;){var o=e,r=t,s=n;i=!1,null===o&&(o=Function.prototype);var c=Object.getOwnPropertyDescriptor(o,r);if(void 0!==c){if("value"in c)return c.value;var l=c.get;if(void 0===l)return;return l.call(s)}var a=Object.getPrototypeOf(o);if(null===a)return;e=a,t=r,n=s,i=!0,c=a=void 0}},h=e.Utils,u=h.extend,d=h.addClass,p=h.removeClass,v=h.hasClass,g=h.getBounds,f=h.Evented,y=13,m=27,k=32,b=38,O=40,E="ontouchstart"in document.documentElement,C=E?"touchstart":"click",L="",T=void 0,w=function(o){function r(e){if(t(this,r),a(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,e),this.options=u({},r.defaults,e),this.select=this.options.el,this.createEventBounds(),"undefined"!=typeof this.select.selectInstance)throw new Error("This element has already been turned into a Select");this.update=this.update.bind(this),this.setupTarget(),this.renderTarget(),this.setupDrop(),this.renderDrop(),this.setupSelect(),this.setupTether(),this.bindClick(),this.bindMutationEvents(),this.value=this.select.value}return n(r,o),l(r,[{key:"createEventBounds",value:function(){var e=this;this.evnts={target:{click:function(){e.isOpen()?e.target.blur():e.target.focus()},focus:function(){d(e.target,"select-target-focused")},blur:function(t){var n=t.relatedTarget;e.isOpen()&&n&&!e.drop.contains(n)&&e.close(),p(e.target,"select-target-focused")},deviceClick:function(t){t.preventDefault(),e.toggle()}},drop:{click:function(t){v(t.target,"select-option")&&e.pickOption(t.target),t.stopPropagation()},mousemove:function(t){v(t.target,"select-option")&&e.highlightOption(t.target)}},document:{click:function(){e.isOpen()&&(event.target===e.drop||e.drop.contains(event.target)||event.target===e.target||e.target.contains(event.target)||e.close())}}}}},{key:"useNative",value:function(){var e=this.options.useNative;return e===!0||i()&&e!==!1}},{key:"setupTarget",value:function(){this.target=document.createElement("a"),this.target.href="javascript:;",d(this.target,"select-target");var e=this.select.getAttribute("tabindex")||0;this.target.setAttribute("tabindex",e),this.options.className&&d(this.target,this.options.className),this.target.selectInstance=this,this.target.addEventListener("click",this.evnts.target.click),this.target.addEventListener("focus",this.evnts.target.focus),this.target.addEventListener("blur",this.evnts.target.blur),this.select.parentNode.insertBefore(this.target,this.select.nextSibling)}},{key:"setupDrop",value:function(){this.drop=document.createElement("div"),d(this.drop,"select"),this.options.className&&d(this.drop,this.options.className),document.body.appendChild(this.drop),this.drop.addEventListener("click",this.evnts.drop.click),this.drop.addEventListener("mousemove",this.evnts.drop.mousemove),this.content=document.createElement("div"),d(this.content,"select-content"),this.drop.appendChild(this.content)}},{key:"open",value:function(){var e=this;if(d(this.target,"select-open"),this.useNative()){var t=document.createEvent("MouseEvents");return t.initEvent("mousedown",!0,!0),void this.select.dispatchEvent(t)}d(this.drop,"select-open"),setTimeout(function(){e.tether.enable()});var n=this.drop.querySelector(".select-option-selected");if(n){this.highlightOption(n),this.scrollDropContentToOption(n);var i=function(){if(v(e.drop,"tether-abutted-left")||v(e.drop,"tether-abutted-bottom")){var t=g(e.drop),i=g(n),o=t.top-(i.top+i.height);e.drop.style.top=(parseFloat(e.drop.style.top)||0)+o+"px"}},o=this.options.alignToHighlighted,r=this.content,s=r.scrollHeight,c=r.clientHeight;("always"===o||"auto"===o&&c>=s)&&setTimeout(function(){i()}),this.trigger("open")}}},{key:"close",value:function(){p(this.target,"select-open"),this.useNative()&&this.select.blur(),this.tether.disable(),p(this.drop,"select-open"),this.trigger("close")}},{key:"toggle",value:function(){this.isOpen()?this.close():this.open()}},{key:"isOpen",value:function(){return v(this.drop,"select-open")}},{key:"bindClick",value:function(){this.target.addEventListener(C,this.evnts.target.deviceClick),document.addEventListener(C,this.evnts.document.click)}},{key:"setupTether",value:function(){this.tether=new e(u({element:this.drop,target:this.target,attachment:"top left",targetAttachment:"bottom left",classPrefix:"select",constraints:[{to:"window",attachment:"together"}]},this.options.tetherOptions))}},{key:"renderTarget",value:function(){this.target.innerHTML="";for(var e=this.select.querySelectorAll("option"),t=0;t<e.length;++t){var n=e[t];if(n.selected){this.target.innerHTML=n.innerHTML;break}}this.target.appendChild(document.createElement("b"))}},{key:"renderDrop",value:function(){var e=document.createElement("ul");d(e,"select-options");for(var t=this.select.querySelectorAll("option"),n=0;n<t.length;++n){var i=t[n],o=document.createElement("li");d(o,"select-option"),o.setAttribute("data-value",i.value),o.innerHTML=i.innerHTML,i.selected&&d(o,"select-option-selected"),e.appendChild(o)}this.content.innerHTML="",this.content.appendChild(e)}},{key:"update",value:function(){this.renderDrop(),this.renderTarget()}},{key:"setupSelect",value:function(){this.select.selectInstance=this,d(this.select,"select-select"),this.select.addEventListener("change",this.update)}},{key:"bindMutationEvents",value:function(){"undefined"!=typeof window.MutationObserver?(this.observer=new MutationObserver(this.update),this.observer.observe(this.select,{childList:!0,attributes:!0,characterData:!0,subtree:!0})):this.select.addEventListener("DOMSubtreeModified",this.update)}},{key:"findOptionsByPrefix",value:function(e){var t=this.drop.querySelectorAll(".select-option");return e=e.toLowerCase(),Array.prototype.filter.call(t,function(t){return t.innerHTML.toLowerCase().substr(0,e.length)===e})}},{key:"findOptionsByValue",value:function(e){var t=this.drop.querySelectorAll(".select-option");return Array.prototype.filter.call(t,function(t){return t.getAttribute("data-value")===e})}},{key:"getChosen",value:function(){return this.isOpen()?this.drop.querySelector(".select-option-highlight"):this.drop.querySelector(".select-option-selected")}},{key:"selectOption",value:function(e){this.isOpen()?(this.highlightOption(e),this.scrollDropContentToOption(e)):this.pickOption(e,!1)}},{key:"resetSelection",value:function(){this.selectOption(this.drop.querySelector(".select-option"))}},{key:"highlightOption",value:function(e){var t=this.drop.querySelector(".select-option-highlight");t&&p(t,"select-option-highlight"),d(e,"select-option-highlight"),this.trigger("highlight",{option:e})}},{key:"moveHighlight",value:function(e){var t=this.drop.querySelector(".select-option-highlight");if(!t)return void this.highlightOption(this.drop.querySelector(".select-option"));var n=this.drop.querySelectorAll(".select-option"),i=Array.prototype.indexOf.call(n,t);if(i>=0&&(e===b?i-=1:i+=1,!(0>i||i>=n.length))){var o=n[i];this.highlightOption(o),this.scrollDropContentToOption(o)}}},{key:"scrollDropContentToOption",value:function(e){var t=this.content,n=t.scrollHeight,i=t.clientHeight,o=t.scrollTop;if(n>i){var r=g(this.content),s=g(e);this.content.scrollTop=s.top-(r.top-o)}}},{key:"selectHighlightedOption",value:function(){this.pickOption(this.drop.querySelector(".select-option-highlight"))}},{key:"pickOption",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];this.value=this.select.value=e.getAttribute("data-value"),this.triggerChange(),n&&setTimeout(function(){t.close(),t.target.focus()})}},{key:"triggerChange",value:function(){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.select.dispatchEvent(e),this.trigger("change",{value:this.select.value})}},{key:"change",value:function(e){var t=this.findOptionsByValue(e);if(!t.length)throw new Error('Select Error: An option with the value "'+e+"\" doesn't exist");this.pickOption(t[0],!1)}},{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",function(){return r.init(e)});"undefined"==typeof e.selector&&(e.selector="select"),document.addEventListener("keypress",s),document.addEventListener("keydown",c);for(var t=document.querySelectorAll(e.selector),n=0;n<t.length;++n){var i=t[n];if(!i.selectInstance){new r(u({el:i},e))}}}},{key:"removeEvents",value:function(){this.target.removeEventListener("click",this.evnts.target.click),this.target.removeEventListener("focus",this.evnts.target.focus),this.target.removeEventListener("blur",this.evnts.target.blur),this.drop.removeEventListener("click",this.evnts.drop.click),this.drop.removeEventListener("mousemove",this.evnts.drop.mousemove),this.target.removeEventListener(C,this.evnts.target.deviceClick),document.removeEventListener(C,this.evnts.document.click),document.removeEventListener("keypress",s),document.removeEventListener("keydown",c),this.select.removeEventListener("change",this.update)}},{key:"destroy",value:function(){this.removeEvents(),this.tether.destroy(),this.target.remove(),this.drop.remove(),delete this.tether,delete this.observer}}]),r}(f);return w.defaults={alignToHighlighed:"auto",className:"select-theme-default"},w});